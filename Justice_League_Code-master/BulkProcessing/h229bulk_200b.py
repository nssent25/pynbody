import matplotlib as mpl
mpl.use('Agg')
import pynbody
import matplotlib.pyplot as plt
import numpy as np
import pynbody.plot as pp
import pynbody.filt as filt
import pickle
import pandas as pd
import logging
from pynbody import array,filt,units,config,transformation
from pynbody.analysis import halo
import os

# set the config to prioritize the AHF catalog
pynbody.config['halo-class-priority'] =  [pynbody.halo.ahf.AHFCatalogue,
                                          pynbody.halo.GrpCatalogue,
                                          pynbody.halo.AmigaGrpCatalogue,
                                          pynbody.halo.legacy.RockstarIntermediateCatalogue,
                                          pynbody.halo.rockstar.RockstarCatalogue,
                                          pynbody.halo.subfind.SubfindCatalogue, pynbody.halo.hop.HOPCatalogue]


from timescales_bulk import bulk_processing # import the bulk processing function

snapnums = ['004096', '004032', '003936', '003840', '003744', '003648', '003606', '003552', '003456', '003360', '003264', '003195', '003168', '003072','002976', '002880', '002784', '002688', '002592', '002554', '002496', '002400', '002304','002208', '002112', '002088', '002016', '001920', '001824','001740','001728','001632', '001536', '001475', '001440', '001344', '001269', '001248','001152', '001106', '001056', '000974', '000960','000864', '000776', '000768', '000672', '000637', '000576', '000480', '000456', '000384', '000347', '000288', '000275', '000225', '000192', '000188', '000139', '000107', '000096', '000071']

# haloids dictionary defines the major progenitor branch back through all snapshots for each z=0 halo we are 
# interest in ... read this as haloids[1] is the list containing the haloid of the major progenitors of halo 1
# so if we have three snapshots, snapshots = [4096, 2048, 1024] then we would have haloids[1] = [1, 2, 5] 
# --- i.e. in snapshot 2048 halo 1 was actually called halo 2, and in 1024 it was called halo 5

### the below haloids and rvirs are updated to match the z=0 haloids in the 200 bkgdens simulations
haloids = {
    1: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 13, 16],
    2: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 4, 4, 4, 4, 3, 4, 4, 5, 5, 7, 15, 20, 23, 24, 23, 24, 48, 87],
    5: [5, 5, 6, 6, 6, 5, 5, 5, 5, 6, 4, 4, 4, 4, 4, 3, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 7, 7, 8, 10, 10, 10, 10, 9, 8, 10, 10, 14, 15, 15, 16, 18, 15, 19, 25, 25, 23, 32, 36, 29, 82],
    7: [7, 7, 7, 7, 8, 7, 6, 6, 7, 7, 7, 6, 6, 6, 7, 6, 7, 8, 8, 8, 7, 6, 6, 8, 8, 8, 8, 8, 7, 8, 8, 9, 9, 10, 11, 11, 11, 12, 12, 12, 12, 11, 12, 12, 21, 20, 24, 24, 28, 35, 38, 53, 59, 77, 87, 217, 234, 231],
    17: [17, 17, 16, 18, 18, 17, 17, 18, 19, 19, 20, 19, 20, 21, 23, 22, 25, 24, 24, 25, 23, 23, 26, 26, 26, 26, 28, 28, 28, 30, 30, 30, 30, 29, 29, 32, 38, 43, 42, 44, 41, 42, 43, 40, 42, 43, 57, 62, 68, 71, 77, 80, 81, 86, 93, 128, 149, 153, 198],
    20: [20, 19, 17, 17, 17, 15, 15, 15, 15, 15, 15, 15, 15, 14, 16, 13, 14, 14, 14, 15, 15, 13, 14, 13, 14, 14, 13, 13, 14, 13, 13, 13, 13, 13, 14, 15, 18, 19, 30, 30, 30, 33, 34, 42, 44, 45, 53, 53, 54, 55, 58, 70, 72, 71, 69, 63, 61, 63, 43, 36, 36, 25],
    22: [22, 22, 22, 22, 22, 21, 20, 21, 21, 21, 21, 20, 19, 18, 20, 18, 17, 16, 16, 14, 10, 10, 10, 11, 10, 10, 10, 10, 9, 9, 9, 8, 7, 7, 8, 9, 9, 10, 9, 9, 8, 8, 8, 9, 9, 8, 9, 9, 10, 9, 10, 9, 6, 17, 20, 20, 21, 22, 20, 40, 40],
    23: [23, 23, 23, 23, 23, 22, 23, 22, 23, 24, 25, 23, 23, 25, 26, 23, 22, 22, 21, 19, 19, 17, 17, 16, 16, 15, 15, 15, 15, 14, 14, 14, 14, 14, 15, 19, 22, 23, 25, 26, 27, 27, 28, 28, 32, 33, 37, 35, 43, 56, 56, 56, 61, 70, 86, 106, 135, 137, 182],
    27: [27, 27, 28, 28, 29, 30, 31, 31, 30, 30, 29, 30, 30, 30, 32, 32, 32, 31, 29, 30, 30, 26, 25, 25, 31, 27, 21, 20, 20, 20, 20, 20, 21, 20, 21, 21, 20, 21, 21, 21, 21, 22, 23, 23, 25, 23, 19, 20, 22, 26, 32, 33, 30, 36, 34, 60, 60, 61, 109],
    29: [29, 29, 30, 30, 32, 32, 33, 33, 32, 33, 33, 34, 34, 36, 38, 38, 39, 37, 37, 37, 37, 38, 38, 37, 36, 36, 38, 37, 37, 41, 41, 36, 34, 36, 36, 35, 35, 38, 37, 36, 36, 38, 40, 37, 39, 40, 47, 46, 50, 52, 55, 60, 64, 61, 62, 57, 49, 48, 40, 26, 20, 12],
    33: [33, 34, 34, 32, 34, 34, 21, 17, 17, 16, 16, 16, 16, 17, 19, 19, 21, 21, 22, 22, 22, 21, 22, 22, 22, 21, 22, 21, 21, 19, 19, 18, 19, 21, 25, 17, 16, 17, 19, 19, 19, 19, 20, 21, 22, 21, 21, 21, 23, 23, 26, 29, 28, 30, 31, 27, 26, 26, 17, 14, 12, 8],
    52: [52, 52, 51, 51, 51, 50, 50, 49, 48, 47, 47, 46, 45, 48, 50, 46, 45, 46, 48, 46, 44, 42, 41, 42, 38, 38, 39, 38, 38, 39, 38, 38, 36, 38, 39, 38, 39, 41, 40, 39, 38, 41, 42, 41, 43, 44, 52, 52, 56, 59, 60, 63, 62, 56, 56, 75, 68, 69, 33, 28, 46],
    53: [53, 54, 54, 69, 53, 52, 51, 50, 49, 48, 48, 47, 46, 47, 48, 47, 46, 47, 46, 44, 42, 40, 39, 41, 40, 39, 36, 31, 27, 28, 28, 26, 25, 26, 27, 27, 27, 28, 28, 28, 24, 24, 25, 69, 56, 56, 62, 63, 64, 82, 88, 95, 106, 279, 291, 277, 253, 245, 190],
    55: [55, 53, 52, 50, 49, 45, 44, 42, 39, 37, 35, 36, 36, 34, 33, 30, 24, 20, 18, 18, 18, 19, 20, 18, 17, 17, 17, 17, 16, 16, 16, 15, 15, 15, 17, 16, 15, 16, 18, 18, 18, 18, 18, 17, 20, 19, 18, 19, 21, 19, 22, 28, 96, 109, 108, 353],
    59: [59, 60, 58, 57, 59, 60, 61, 61, 60, 59, 58, 58, 57, 59, 60, 58, 61, 62, 64, 64, 64, 64, 65, 64, 65, 66, 65, 66, 64, 65, 63, 62, 57, 56, 56, 47, 44, 47, 46, 46, 52, 57, 59, 60, 67, 69, 72, 74, 81, 77, 83, 91, 98, 90, 92, 110, 359, 356],
    61: [61, 61, 62, 63, 64, 64, 64, 65, 65, 64, 66, 67, 65, 66, 67, 65, 67, 66, 67, 65, 67, 67, 66, 65, 66, 67, 70, 69, 71, 71, 71, 73, 76, 76, 76, 77, 81, 81, 81, 78, 80, 81, 84, 92, 100, 100, 109, 110, 111, 106, 120, 138, 170, 178, 181, 174, 145, 144, 118, 85, 70],
    62: [62, 62, 63, 62, 61, 59, 58, 58, 59, 57, 57, 55, 67, 41, 40, 39, 40, 39, 41, 40, 40, 41, 43, 46, 46, 47, 49, 48, 49, 51, 51, 53, 55, 53, 55, 53, 56, 56, 58, 61, 61, 69, 68, 77, 80, 81, 95, 102, 96, 92, 96, 115, 123, 189, 195, 171, 147, 148, 121, 104],
    73: [73, 72, 70, 71, 71, 68, 68, 68, 70, 66, 67, 63, 62, 65, 30, 27, 29, 28, 28, 29, 28, 30, 30, 28, 28, 29, 30, 30, 29, 31, 31, 28, 26, 25, 26, 26, 25, 26, 27, 27, 25, 25, 26, 26, 29, 28, 29, 29, 32, 37, 37, 41, 36, 38, 38, 44, 40, 39, 36, 103],
    104: [104, 106, 105, 107, 105, 105, 107, 109, 106, 102, 105, 105, 105, 106, 102, 98, 94, 87, 88, 86, 84, 84, 83, 81, 82, 81, 83, 82, 82, 82, 82, 80, 81, 80, 79, 74, 73, 73, 64, 66, 63, 58, 55, 49, 54, 54, 68, 70, 74, 72, 79, 90, 99, 110, 113, 105, 126, 128, 185],
    113: [113, 111, 104, 96, 87, 82, 78, 78, 77, 75, 77, 77, 75, 74, 73, 70, 60, 53, 52, 50, 50, 50, 40, 40, 37, 37, 40, 39, 39, 40, 37, 37, 35, 33, 32, 37, 29, 31, 26, 25, 26, 26, 27, 27, 31, 31, 34, 32, 39, 41, 41, 42, 34, 37, 36, 54, 87, 90],
    139: [139, 140, 137, 136, 137, 136, 137, 135, 134, 129, 135, 120, 111, 102, 100, 100, 102, 99, 101, 99, 98, 99, 99, 101, 103, 104, 105, 109, 102, 103, 103, 105, 104, 101, 104, 103, 106, 109, 111, 109, 112, 111, 113, 116, 121, 122, 125, 126, 131, 127, 132, 147, 155, 148, 130, 123, 202, 207, 155],
    212: [212, 212, 208, 200, 186, 178, 175, 171, 159, 85, 79, 80, 79, 81, 80, 77, 77, 73, 69, 66, 66, 65, 48, 35, 34, 34, 35, 35, 33, 35, 35, 32, 32, 31, 35, 29, 31, 34, 35, 35, 35, 37, 38, 34, 36, 36, 45, 41, 49, 49, 50, 49, 45, 58, 61, 89, 76, 76, 56, 53, 55],
    290: [290, 288, 287, 287, 284, 284, 286, 290, 295, 297, 306, 307, 310, 314, 313, 315, 322, 325, 328, 323, 318, 307, 287, 276, 281, 281, 345, 219, 222, 228, 229, 238, 261, 258, 267, 268, 269, 274, 281, 279, 283, 275, 278, 263, 251, 253, 294, 296, 301, 314, 321, 326, 330, 334, 329, 339, 343, 345],
    549: [549, 548, 537, 550, 522, 511, 501]
}

rvirs = {
    2: [122.84, 120.81, 117.78, 114.8, 111.84, 108.85, 107.58, 105.91, 102.99, 100.07, 97.09, 94.98, 94.21, 91.46, 88.75, 86.02, 83.37, 80.68, 77.96, 76.91, 75.25, 72.36, 69.65, 66.95, 64.34, 63.69, 61.68, 59.08, 56.36, 54.0, 53.66, 51.1, 48.43, 46.85, 45.9, 42.78, 40.54, 39.92, 37.27, 35.9, 34.65, 32.97, 32.74, 29.9, 27.65, 27.49, 25.31, 24.08, 21.36, 14.82, 14.3, 11.12, 6.35, 6.05, 5.61, 4.36, 3.51, 3.42, 1.71, 0.97],
    5: [73.57, 72.41, 70.7, 69.02, 67.33, 65.63, 64.9, 63.97, 62.26, 60.52, 58.88, 57.7, 57.22, 55.51, 53.83, 51.99, 50.28, 48.61, 46.93, 46.26, 45.1, 43.27, 41.65, 40.07, 38.49, 38.11, 37.03, 35.54, 34.04, 32.75, 32.55, 31.02, 29.49, 28.44, 27.84, 26.16, 24.93, 24.59, 22.97, 22.31, 21.68, 20.89, 20.81, 20.04, 17.92, 17.75, 12.68, 11.73, 10.71, 9.21, 8.87, 7.57, 6.86, 5.56, 5.28, 4.41, 3.11, 2.87, 1.98, 0.98],
    7: [66.7, 65.72, 64.27, 62.76, 61.18, 59.44, 58.74, 57.89, 56.33, 54.89, 53.32, 52.08, 51.51, 48.82, 47.33, 45.86, 44.64, 43.34, 42.18, 41.79, 41.26, 40.23, 38.92, 37.17, 35.67, 35.35, 34.56, 32.76, 30.86, 29.41, 29.16, 27.2, 25.62, 24.65, 24.12, 22.72, 21.77, 21.53, 20.23, 19.69, 19.15, 18.29, 18.06, 16.51, 12.26, 12.04, 10.51, 9.93, 8.87, 7.31, 6.83, 5.3, 4.77, 3.64, 3.37, 1.84, 1.54, 1.49],
    17: [43.74, 43.01, 41.96, 40.9, 39.83, 38.79, 38.35, 37.83, 36.94, 35.99, 35.08, 34.42, 34.15, 33.27, 32.32, 31.25, 30.29, 29.4, 28.36, 27.95, 27.39, 26.5, 25.49, 24.67, 23.78, 23.55, 22.83, 21.93, 20.92, 20.17, 20.06, 18.93, 17.53, 16.89, 16.51, 14.95, 13.5, 13.2, 12.12, 11.63, 11.39, 10.87, 10.76, 9.97, 9.07, 8.95, 7.62, 7.15, 6.5, 5.4, 5.15, 4.5, 4.17, 3.5, 3.28, 2.23, 1.8, 1.75, 1.09],
    20: [42.98, 42.4, 41.55, 40.72, 39.89, 46.0, 45.53, 44.92, 43.85, 42.78, 41.73, 40.98, 40.68, 39.64, 38.61, 37.59, 36.57, 35.55, 34.54, 34.15, 33.54, 32.53, 31.53, 30.5, 29.3, 29.04, 28.23, 27.14, 26.06, 25.11, 24.99, 24.02, 23.16, 22.42, 21.93, 19.99, 18.18, 17.71, 14.09, 13.46, 12.87, 11.77, 11.57, 9.79, 8.96, 8.89, 7.93, 7.58, 7.03, 6.09, 5.79, 4.86, 4.43, 3.79, 3.64, 2.97, 2.43, 2.37, 1.76, 1.28, 1.08],
    22: [56.21, 55.37, 54.13, 52.9, 51.69, 50.48, 49.96, 49.29, 48.12, 46.95, 45.79, 44.97, 44.64, 43.5, 42.37, 41.25, 40.13, 39.02, 37.91, 37.47, 36.8, 35.7, 34.6, 33.5, 32.4, 32.16, 31.38, 30.34, 29.3, 28.36, 28.23, 27.19, 26.26, 25.64, 25.3, 25.42, 24.42, 24.14, 22.84, 22.49, 22.02, 21.1, 20.89, 19.61, 17.97, 17.81, 15.92, 15.22, 13.82, 11.9, 11.42, 9.98, 9.42, 6.41, 5.71, 4.67, 3.7, 3.51, 2.15, 1.26, 1.03],
    23: [49.65, 48.92, 47.82, 46.73, 45.66, 44.6, 44.14, 43.55, 42.51, 41.48, 40.45, 39.72, 39.44, 38.43, 37.43, 36.44, 35.45, 34.47, 33.49, 33.1, 32.51, 31.54, 30.57, 29.6, 28.62, 28.35, 27.55, 26.29, 25.28, 24.41, 24.29, 23.34, 21.9, 21.02, 20.72, 18.9, 16.7, 16.39, 15.05, 14.51, 13.86, 12.89, 12.79, 11.57, 10.48, 10.4, 9.06, 8.62, 7.89, 6.12, 5.91, 5.31, 4.81, 3.85, 3.43, 2.39, 1.85, 1.8, 1.12],
    27: [43.5, 42.85, 41.89, 40.94, 40.0, 39.07, 38.67, 38.15, 37.24, 36.34, 35.44, 34.8, 34.55, 33.67, 32.79, 31.92, 31.06, 30.2, 29.34, 29.0, 28.48, 27.63, 26.78, 25.93, 25.08, 24.86, 24.22, 23.37, 22.59, 21.86, 21.75, 20.95, 20.17, 19.65, 19.36, 18.42, 17.62, 17.4, 16.32, 15.83, 15.32, 14.4, 14.25, 13.06, 12.04, 11.95, 10.99, 10.59, 9.68, 7.68, 7.18, 6.24, 5.8, 4.82, 4.6, 2.99, 2.44, 2.38, 1.35],
    29: [35.68, 35.12, 34.32, 33.51, 32.73, 31.94, 31.6, 31.18, 30.38, 29.63, 28.85, 28.28, 28.06, 27.31, 26.55, 25.84, 25.1, 24.36, 23.65, 23.37, 22.93, 22.21, 21.52, 20.83, 20.16, 20.0, 19.51, 18.86, 18.19, 14.09, 13.55, 16.84, 16.13, 15.66, 15.39, 14.58, 13.96, 13.78, 12.95, 12.55, 12.1, 11.32, 11.18, 10.26, 9.39, 9.32, 8.34, 7.99, 7.36, 6.26, 6.0, 5.25, 4.82, 4.11, 3.93, 3.15, 2.64, 2.58, 1.87, 1.44, 1.32],
    33: [44.27, 43.61, 42.63, 41.66, 40.71, 39.76, 39.35, 38.82, 37.9, 36.98, 36.07, 35.42, 35.14, 34.26, 33.37, 32.49, 31.59, 30.69, 29.77, 29.41, 28.85, 27.94, 27.02, 26.1, 25.18, 24.96, 24.27, 23.44, 22.66, 22.07, 21.99, 21.38, 20.74, 13.16, 9.46, 19.51, 19.04, 18.85, 17.82, 17.22, 16.54, 15.3, 15.09, 13.71, 12.54, 12.43, 11.11, 10.62, 9.69, 8.4, 8.04, 6.86, 6.36, 5.28, 5.03, 4.1, 3.47, 3.39, 2.3, 1.79, 1.62],
    52: [35.07, 34.55, 33.78, 33.01, 32.25, 31.5, 31.18, 30.76, 30.03, 29.3, 28.58, 28.06, 27.86, 27.15, 26.44, 25.74, 25.04, 24.35, 23.66, 23.38, 22.97, 22.28, 21.59, 20.91, 20.22, 20.05, 19.53, 18.84, 18.09, 17.39, 17.3, 16.54, 15.73, 15.2, 14.89, 14.06, 13.44, 13.27, 12.44, 12.04, 11.62, 10.93, 10.81, 9.94, 9.1, 9.02, 8.08, 7.73, 7.12, 6.1, 5.86, 5.14, 4.81, 4.21, 3.98, 2.77, 2.37, 2.33, 1.88, 1.37, 1.01],
    53: [40.61, 40.0, 39.11, 38.22, 37.34, 36.47, 36.1, 35.61, 34.76, 33.92, 33.08, 32.49, 32.25, 31.43, 30.61, 29.8, 28.99, 28.19, 27.39, 27.07, 26.59, 25.79, 25.0, 24.2, 23.41, 23.21, 22.61, 21.81, 21.01, 20.31, 20.19, 19.26, 18.34, 17.72, 17.38, 16.43, 15.59, 15.43, 14.86, 14.45, 14.1, 13.44, 13.12, 5.85, 8.39, 8.29, 7.5, 7.25, 6.64, 5.3, 4.99, 4.19, 3.67, 2.0, 1.87, 1.61, 1.45, 1.43, 1.1],
    55: [46.66, 45.96, 44.93, 43.91, 42.91, 41.91, 41.48, 40.92, 39.94, 38.97, 38.01, 37.33, 37.06, 36.11, 35.18, 34.24, 33.31, 32.39, 31.47, 31.11, 30.55, 29.64, 28.72, 27.9, 27.02, 26.8, 26.09, 25.12, 24.14, 23.28, 23.16, 22.18, 21.31, 20.83, 20.55, 19.85, 19.19, 18.95, 17.84, 17.24, 16.54, 15.5, 15.34, 14.0, 12.67, 12.55, 11.25, 10.84, 10.01, 8.74, 8.39, 6.74, 3.81, 3.1, 2.99, 1.49],
    59: [28.73, 28.3, 27.71, 27.08, 26.49, 25.86, 25.6, 25.27, 24.71, 24.11, 23.51, 23.08, 22.91, 22.29, 21.69, 21.08, 20.47, 19.85, 19.22, 18.97, 18.6, 17.97, 17.35, 16.75, 16.19, 16.04, 15.66, 15.16, 14.73, 14.29, 14.24, 13.79, 13.62, 13.32, 13.2, 12.77, 12.54, 12.4, 11.43, 11.04, 10.4, 9.46, 9.32, 8.44, 7.75, 7.69, 6.98, 6.69, 6.12, 5.3, 5.06, 4.19, 3.8, 3.42, 3.29, 2.37, 1.26, 1.25],
    61: [28.11, 27.69, 27.07, 26.46, 25.85, 25.25, 25.03, 24.67, 24.06, 23.47, 22.83, 22.39, 22.23, 21.66, 21.06, 20.49, 19.91, 19.36, 18.85, 18.61, 18.26, 17.71, 17.17, 16.66, 16.15, 16.01, 15.5, 14.98, 14.46, 13.94, 13.85, 13.21, 12.53, 12.09, 11.85, 11.16, 10.65, 10.5, 9.78, 9.45, 9.12, 8.49, 8.37, 7.63, 6.92, 6.86, 6.03, 5.74, 5.26, 4.49, 4.18, 3.43, 2.87, 2.39, 2.29, 1.98, 1.81, 1.77, 1.31, 0.98, 0.86],
    62: [28.01, 27.62, 27.03, 26.62, 30.95, 30.23, 29.92, 29.52, 28.81, 28.11, 27.42, 26.93, 26.73, 26.05, 25.37, 24.7, 24.03, 23.3, 22.5, 22.2, 21.72, 20.82, 20.0, 19.25, 18.53, 18.33, 17.78, 17.02, 16.25, 15.56, 15.48, 14.81, 14.0, 13.48, 13.24, 12.41, 11.72, 11.54, 10.5, 10.1, 9.7, 9.01, 8.9, 8.03, 7.38, 7.31, 6.4, 6.01, 5.57, 4.89, 4.62, 3.72, 3.33, 2.31, 2.23, 1.98, 1.79, 1.76, 1.29, 0.92],
    73: [40.48, 39.87, 38.98, 38.09, 37.22, 36.35, 35.98, 35.5, 34.65, 33.81, 32.98, 32.38, 32.15, 31.33, 30.51, 29.7, 28.9, 28.1, 27.3, 26.98, 26.48, 25.65, 24.83, 24.01, 23.19, 22.98, 22.37, 21.54, 20.71, 20.0, 19.9, 19.08, 18.26, 17.73, 17.41, 16.55, 15.89, 15.71, 14.85, 14.43, 13.92, 13.01, 12.86, 11.77, 10.85, 10.76, 9.81, 9.45, 8.67, 7.36, 7.0, 5.95, 5.52, 4.71, 4.5, 3.34, 2.79, 2.75, 1.87, 0.92],
    104: [26.87, 26.47, 25.88, 25.29, 24.71, 24.14, 23.89, 23.57, 23.0, 22.45, 21.89, 21.5, 21.34, 20.8, 20.26, 19.72, 19.19, 18.65, 18.12, 17.91, 17.6, 17.07, 16.54, 16.02, 15.49, 15.36, 14.96, 14.43, 13.9, 13.44, 13.37, 12.83, 12.29, 11.96, 11.76, 11.24, 10.83, 10.71, 10.18, 9.93, 9.69, 9.46, 9.44, 9.26, 8.55, 8.48, 7.23, 6.93, 6.41, 5.43, 5.16, 4.24, 3.8, 3.05, 2.87, 2.39, 1.93, 1.87, 1.12],
    113: [30.75, 30.29, 29.61, 28.94, 28.28, 27.62, 27.34, 26.97, 26.33, 25.69, 25.05, 24.6, 24.43, 23.8, 23.18, 22.57, 21.96, 21.35, 20.74, 20.5, 20.14, 17.27, 20.01, 20.46, 19.93, 19.79, 19.35, 18.7, 17.94, 17.3, 17.22, 16.54, 15.37, 15.87, 15.87, 8.66, 14.05, 10.82, 14.99, 14.49, 13.9, 12.94, 12.8, 11.69, 10.69, 10.59, 9.56, 9.21, 8.42, 6.97, 6.69, 5.92, 5.57, 4.78, 4.54, 3.1, 2.18, 2.11],
    139: [20.63, 23.65, 23.12, 22.6, 22.08, 21.56, 21.34, 21.06, 20.55, 20.05, 19.56, 19.21, 19.07, 18.58, 18.1, 17.62, 17.14, 16.73, 16.28, 16.11, 15.85, 15.37, 14.93, 14.43, 13.92, 13.8, 13.43, 12.91, 12.45, 12.05, 12.0, 11.53, 11.05, 10.68, 10.48, 9.95, 9.49, 9.36, 8.8, 8.48, 8.15, 7.6, 7.51, 6.88, 6.32, 6.27, 5.63, 5.36, 4.87, 4.16, 3.97, 3.34, 2.97, 2.62, 2.64, 2.27, 1.59, 1.54, 1.18],
    212: [37.21, 36.66, 35.84, 35.03, 34.22, 33.43, 33.08, 32.64, 31.86, 31.09, 30.32, 29.77, 29.56, 28.8, 28.06, 27.31, 26.57, 25.83, 25.1, 24.81, 24.37, 23.64, 22.91, 22.18, 21.45, 21.27, 20.72, 19.94, 19.1, 18.37, 18.26, 17.48, 16.68, 16.14, 15.86, 15.01, 14.26, 14.04, 13.04, 12.65, 12.2, 11.43, 11.31, 10.41, 9.54, 9.45, 8.42, 8.13, 7.47, 6.34, 6.09, 5.45, 5.11, 4.17, 3.9, 2.66, 2.28, 2.23, 1.7, 1.15, 0.95],
    290: [15.91, 15.67, 15.32, 14.97, 14.64, 14.34, 14.19, 13.94, 13.58, 13.3, 12.9, 12.64, 12.61, 12.19, 11.86, 11.51, 11.23, 10.84, 10.55, 10.43, 10.29, 10.09, 9.99, 9.84, 9.53, 9.44, 4.19, 9.75, 9.3, 8.93, 8.85, 8.42, 7.74, 7.45, 7.29, 6.91, 6.61, 6.51, 6.08, 5.9, 5.69, 5.38, 5.32, 5.06, 4.74, 4.69, 3.99, 3.82, 3.53, 2.96, 2.83, 2.44, 2.24, 1.88, 1.8, 1.51, 1.29, 1.26],
    549: [15.91, 15.67, 15.32, 14.97, 14.63, 14.29, 14.14]
}

# simulation data is stored in Prof. Christensen's home directory
name = 'h229'
path= '/home/christenc/Data/Sims/'+name+'.cosmo50PLK.3072g/'+name+'.cosmo50PLK.3072gst5HbwK1BH/snapshots_200bkgdens/'
snapshots = [name+'.cosmo50PLK.3072gst5HbwK1BH.'+snapnum for snapnum in snapnums]

for key in list(haloids.keys()):
    if len(haloids[key]) != len(snapshots):
        for i in range(len(snapshots)-len(haloids[key])):
            haloids[key].append(0)
                        
print(haloids)

# relative path should work within github repo, change if running outside of repo
savepath = f'../Data/timesteps_data/{name}.data' 

if os.path.exists(savepath):
    os.remove(savepath)
    print('Removed previous .data file')
print(f'Saving to {savepath}')

for tstep in range(len(snapshots)):
    bulk_processing(tstep, haloids, rvirs, snapshots, path, savepath)
